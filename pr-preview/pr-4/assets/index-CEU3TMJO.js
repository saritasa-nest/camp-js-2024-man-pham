var y=Object.defineProperty;var b=(s,t,e)=>t in s?y(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var n=(s,t,e)=>b(s,typeof t!="symbol"?t+"":t,e);import"./modulepreload-polyfill-B5Qt9EMX.js";class c{constructor(){n(this,"subscribers",[])}subscribe(t){this.getSubscriberIndex(t)===-1&&this.subscribers.push(t)}unsubscribe(t){const e=this.getSubscriberIndex(t);e!==-1&&this.subscribers.splice(e,1)}notify(t){this.subscribers.forEach(e=>e.update(t))}getSubscriberIndex(t){return this.subscribers.findIndex(e=>e===t)}}class a{constructor(){n(this,"diceResults",[]);n(this,"result",new c)}get totalScore(){return this.diceResults.reduce((t,e)=>t+e,0)}updateDicesList(t){this.diceResults.push(t.diceResult)}}function E(s){return(s==null?void 0:s.tagName.toLowerCase())==="button"}function m(s){return(s==null?void 0:s.nodeType)===Node.ELEMENT_NODE}class d{constructor(t,e){this.dicesOrder=t,this.totalScore=e}}class h{constructor(t){n(this,"containerElement",null);this.containerElement=document.getElementById(t)}createElement(t){const e=document.createElement("div");return e.innerHTML=t.trim(),m(e.firstChild)?e.firstChild:null}}class o extends h{constructor(e){super(e);n(this,"resultElement",null);n(this,"totalScoreElement",null);this.containerElement=this.createResultDisplayerElement(e);const r=document.getElementById("wrapper");this.containerElement&&(r==null||r.appendChild(this.containerElement)),this.resultElement=document.getElementById(`${e}-dice-results`),this.totalScoreElement=document.getElementById(`${e}-score`)}createResultDisplayerElement(e){return this.createElement(`<article id="${e}" class="displayer">
				<div>
                	<h2 class="displayer__heading">${e}
						<span id="${e}-score"></span>
					</h2>
				</div>
				<div id="${e}-dice-results" class="displayer__dice-results"></div>
            </article>`)}renderNewResult(e){this.resultElement&&(this.resultElement.innerText=`${e.dicesOrder.join(", ")}`),this.totalScoreElement&&(this.totalScoreElement.innerText=` - ${e.totalScore}`)}update(e){this.renderNewResult({...e})}}class f extends h{constructor(t){super(t)}update(t){var e;if(t){(e=this.containerElement)==null||e.classList.add("displayer_win");const r=document.getElementById("button-roll");E(r)&&(r.disabled=!0,r.innerText="We have a winner ðŸ¥³")}}}class x extends a{update(t){this.updateDicesList(t),this.result.notify(new d(this.diceResults,this.totalScore))}}const i=class i extends c{constructor(e){super();n(this,"sidesCount");this.sidesCount=e}static getInstance(){return i.instance==null&&(i.instance=new i(6)),i.instance}roll(){const e=Math.floor(Math.random()*this.sidesCount)+1;this.notify(e)}};n(i,"instance");let l=i;const I=21;class g extends a{constructor(e){super();n(this,"winStatus",new c);this.playerIndex=e}update(e){e.playerIndex===this.playerIndex&&(this.updateDicesList(e),this.result.notify(new d(this.diceResults,this.totalScore))),this.totalScore>=I&&this.winStatus.notify(!0)}}class w{constructor(t,e){this.playerIndex=t,this.diceResult=e}}class S extends c{constructor(e){super();n(this,"currentPlayerIndex",0);this.playerCount=e}moveToNextPlayer(){this.currentPlayerIndex=(this.currentPlayerIndex+1)%this.playerCount}update(e){const r=new w(this.currentPlayerIndex,e);this.notify(r),this.moveToNextPlayer()}next(){l.getInstance().roll()}}class R{constructor(){n(this,"playerCount",2);n(this,"diceGenerator",l.getInstance());n(this,"turnGenerator");this.turnGenerator=new S(this.playerCount);const t=new x,e=new o("debugger");t.result.subscribe(e),this.turnGenerator.subscribe(t),this.createPlayers().forEach(u=>{this.turnGenerator.subscribe(u)}),this.diceGenerator.subscribe(this.turnGenerator)}createPlayers(){return Array(this.playerCount).fill(null).map((t,e)=>{const r=new g(e),u=new o(`player${e+1}`),p=new f(`player${e+1}`);return r.result.subscribe(u),r.winStatus.subscribe(p),r})}roll(){this.turnGenerator.next()}}const C=new R;window.onload=function(){const s=document.getElementById("button-roll");s&&(s.onclick=function(){C.roll()})};
