var p=Object.defineProperty;var y=(s,t,e)=>t in s?p(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var r=(s,t,e)=>y(s,typeof t!="symbol"?t+"":t,e);import"./modulepreload-polyfill-B5Qt9EMX.js";class c{constructor(){r(this,"subscribers",[])}subscribe(t){this.getSubscriberIndex(t)===-1&&this.subscribers.push(t)}unsubscribe(t){const e=this.getSubscriberIndex(t);e!==-1&&this.subscribers.splice(e,1)}notify(t){this.subscribers.forEach(e=>e.update(t))}getSubscriberIndex(t){return this.subscribers.findIndex(e=>e===t)}}class a{constructor(){r(this,"diceResults",[]);r(this,"result",new c)}get totalScore(){return this.diceResults.reduce((t,e)=>t+e,0)}updateDicesList(t){this.diceResults.push(t.diceResult)}}class b extends a{update(t){this.updateDicesList(t);const e={dicesOrder:this.diceResults,totalScore:this.totalScore};this.result.notify(e)}}function E(s){const{crypto:t}=window,e=new Uint32Array(1);return t.getRandomValues(e),1+Math.floor(e[0]%s)}const m=6,i=class i extends c{constructor(e){super();r(this,"sidesCount");this.sidesCount=e}static getInstance(){return i.instance==null&&(i.instance=new i(m)),i.instance}roll(){const e=E(this.sidesCount);this.notify(e)}};r(i,"instance");let l=i;function f(s){return(s==null?void 0:s.tagName.toLowerCase())==="button"}function g(s){return(s==null?void 0:s.nodeType)===Node.ELEMENT_NODE}class o{constructor(t){r(this,"containerElement",null);this.containerElement=document.getElementById(t)}createElement(t){const e=document.createElement("div");return e.innerHTML=t.trim(),g(e.firstChild)?e.firstChild:null}}class u extends o{constructor(e){super(e);r(this,"resultElement",null);r(this,"totalScoreElement",null);this.containerElement=this.createResultDisplayerElement(e);const n=document.getElementById("wrapper");this.containerElement&&(n==null||n.appendChild(this.containerElement)),this.resultElement=document.getElementById(`${e}-dice-results`),this.totalScoreElement=document.getElementById(`${e}-score`)}createResultDisplayerElement(e){return this.createElement(`<article id="${e}" class="displayer">
				<div>
                	<h2 class="displayer__heading">${e}
						<span id="${e}-score"></span>
					</h2>
				</div>
				<div id="${e}-dice-results" class="displayer__dice-results"></div>
            </article>`)}renderNewResult(e){this.resultElement&&(this.resultElement.innerText=`${e.dicesOrder.join(", ")}`),this.totalScoreElement&&(this.totalScoreElement.innerText=` - ${e.totalScore}`)}update(e){this.renderNewResult(e)}}class I extends o{update(t){var e;if(t){(e=this.containerElement)==null||e.classList.add("displayer_win");const n=document.getElementById("button-roll");f(n)&&(n.disabled=!0,n.innerText="We have a winner ðŸ¥³")}}}const x=21;class w extends a{constructor(e){super();r(this,"playerIndex");r(this,"winStatus",new c);this.playerIndex=e}update(e){if(e.playerIndex===this.playerIndex){this.updateDicesList(e);const n={dicesOrder:this.diceResults,totalScore:this.totalScore};this.result.notify(n)}this.totalScore>=x&&this.winStatus.notify(!0)}}class S extends c{constructor(e){super();r(this,"currentPlayerIndex",0);r(this,"playerCount");this.playerCount=e}moveToNextPlayer(){this.currentPlayerIndex=(this.currentPlayerIndex+1)%this.playerCount}update(e){const n={playerIndex:this.currentPlayerIndex,diceResult:e};this.notify(n),this.moveToNextPlayer()}playTurn(){l.getInstance().roll()}}class T{constructor(){r(this,"playerCount",2);r(this,"diceGenerator",l.getInstance());r(this,"turnGenerator",new S(this.playerCount));const t=new b,e=new u("debugger");t.result.subscribe(e),this.turnGenerator.subscribe(t),this.registerPlayers(),this.diceGenerator.subscribe(this.turnGenerator)}registerPlayers(){Array(this.playerCount).fill(null).map((t,e)=>{const n=new w(e),d=new u(`player${e+1}`),h=new I(`player${e+1}`);n.result.subscribe(d),n.winStatus.subscribe(h),this.turnGenerator.subscribe(n)})}playTurn(){this.turnGenerator.playTurn()}}const C=new T;window.onload=function(){const s=document.getElementById("button-roll");s&&(s.onclick=function(){C.playTurn()})};
